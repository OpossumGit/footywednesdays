<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body onload="init()">

<script>
    // POSTanje prijave
    var postPrijava = function(){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status==200) {
                init(); 
            }
	};
        var name = document.getElementById("ime").value;
        xhttp.open("POST", "api/prijave?name="+name);
	xhttp.send();

    };
	
    //DELETEanje prijave
    var deletePrijava = function(id) {
	var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status==200) {
                init(); 
            }
	};
        xhttp.open("DELETE", "api/prijave?id="+id);
	xhttp.send();
    }

    // GETanje svih prijava i iscrtavanje tablice
    var init = function(){
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status==200) {		
		var prijavljeni = JSON.parse(xhttp.response);
		var table = document.getElementById("prijaveTab");
		if (prijavljeni.length == 0) table.innerHTML = ""; // clear table content
		else table.innerHTML = "<tr><td>Prijavljen</td><td>Briši</td></tr>"; // clear table content
                for (var x = 0; x<prijavljeni.length; x++) {
		    var row = table.insertRow(-1);
		    var cell0 = row.insertCell(0);
		    var cell1 = row.insertCell(1);
		    cell0.innerHTML = prijavljeni[x].name;
		    cell1.innerHTML = "<div onclick=\"if(confirm('Obriši zapis: "+prijavljeni[x].name+"?')) deletePrijava('"+prijavljeni[x]._id+"')\" style=\"cursor:pointer;text-align:center\">&#9003;</div>";
		}
		if (prijavljeni.length>0) table.insertRow(-1).insertCell(0).innerHTML = "Prijava: " + prijavljeni.length;
            }
        };
        xhttp.open("GET","api/prijave");
        xhttp.send();

        document.getElementById("ime").value = ""; 
        document.getElementById("ime").focus(); 
    };

</script>
<div class="FWStyle">
	<div class="insert">Prijave za iduću srijedu:</div>
	<div class="insert">&#9998;<input id="ime" type="text" onkeydown="if (event.keyCode==13) postPrijava()"></div>

	<table id ="prijaveTab">
	</table>
</div>
</body>
</html> 
